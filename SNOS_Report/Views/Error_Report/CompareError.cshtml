
@{
    ViewBag.Title = "CompareError";
    List<SNOS_Report.Database.Mac_Spec> lineinfor = ViewBag.linelist;
    string linename = "";
}

<main class="content">
    <div class="container-fluid p-0">
        <div class="mb-3">
            <h1 class="h3 d-inline align-middle">CompareData Monthly</h1>
        </div>
        <div class="card">
            <div class="card-header pb-0">
                <div class="row">
                    <div class="mb-3 col-md-4">
                        <label class="form-label">Month</label>
                        <select id="month" class="form-select">
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>
                    <div class="mb-3 col-md-4">
                        <label class="form-label">Year</label>
                        <input type="number" id="year" class="form-control" min="2000" max="2100" value="2024">
                    </div>
                    <div class="mb-3 col-md-2">
                        <label class="form-label">Line</label>
                        <select class="form-select" aria-label="Default select example" id="line" onchange="changeline()">
                            @{
                                int ct = 1;
                                foreach (var x in lineinfor)
                                {
                                    if (x.Line_No == ViewBag.Line)
                                    {
                                        <option selected value="@x.Line_No">@x.Line_Name</option>
                                        linename = x.Line_Name;

                                    }
                                    else
                                    {
                                        <option value="@x.Line_No">@x.Line_Name</option>

                                    }
                                }
                            }
                        </select>
                    </div>
                    <div class="mb-3 col-md-2 d-flex align-items-end">
                        <button id="showChart" class="btn btn-primary w-100" onclick="searchclick();">Show Chart</button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="myChart"></div>
            </div>
        </div>
    </div>
</main>

<script>
    $(document).ready(function () {
        if (localStorage.getItem("selectedMonth")) {
            $("#month").val(localStorage.getItem("selectedMonth"));
        }
        if (localStorage.getItem("selectedYear")) {
            $("#year").val(localStorage.getItem("selectedYear"));
        }
            loadChart();
    });
    $("#month, #year").change(function () {
        localStorage.setItem("selectedMonth", $("#month").val());
        localStorage.setItem("selectedYear", $("#year").val());
    });

    function loadChart() {
        var rawData = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.Errordata));

        console.log("Raw Data:", rawData); // ตรวจสอบข้อมูล

        if (!rawData || rawData.length === 0) {
            console.error("Error: No data found in ViewBag.Errordata");
            return;
        }

        var categories = rawData.map(item => item.Title);
        var lastCounts = rawData.map(item => item.Last_Count);
        var thisCounts = rawData.map(item => item.This_Count);

        var options = {
            series: [
                { name: 'Last Count', data: lastCounts },
                { name: 'This Count', data: thisCounts }
            ],
            chart: { type: 'bar', height: 350 },
            plotOptions: { bar: { horizontal: false, columnWidth: '50%' } },
            xaxis: { categories: categories },
            title: { text: 'Error Comparison: Last Count vs This Count' }
        };

        window.myChart = new ApexCharts($("#myChart")[0], options);
        window.myChart.render();
    }

    function searchclick() {
        var month = document.getElementById("month").value;
        var year = document.getElementById("year").value;
        var line = document.getElementById("line").value;
        window.location.replace("../Error_Report/CompareError?month=" + month + "&year=" + year + "&line=" + line);
    }
</script>



